# Counterfactual Bias Analysis

Jupyter notebooks and CSV outputs to perform counterfactual bias analysis across five LLMs.  
Compute semantic similarity and sentiment shifts between scenario variations.

---

## 📋 Table of Contents
- [About](#about)
- [Repository Structure](#repository-structure)
- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Usage](#usage)
- [Configuration](#configuration)
- [Notebook Overview](#notebook-overview)
- [Outputs](#outputs)
- [Contributing](#contributing)
- [License](#license)

---

## 🧐 About
This collection performs counterfactual comparisons of model outputs on neutral‐name scenarios.  
For each LLM (GPT-4o, LLama 3.1, Mistral 3.1, Phi 4, Qwen 2.5), it computes:
- Semantic similarity (cosine) between variations  
- Sentiment polarity shifts (TextBlob)  

Two summary notebooks aggregate results across all five models.

---

## 🗂️ Repository Structure

Code_Conterfactual_Analysis/
├── CounterAnalys-GPT4o.ipynb
├── CounterAnalysisLlama3.1.ipynb
├── CounterAnalysisMistral.ipynb
├── CounterAnalysisPhi4.ipynb
├── CounterAnalysisQwen2.5.ipynb
├── CounterSentimentShiftAnalysis5LLMs.ipynb
├── CounterSimilarityDistributionQs5LLMs.ipynb
├── counterfactual_bias_analysis_gpt4o.csv
├── counterfactual_bias_analysis_llama3.1.csv
├── counterfactual_bias_analysis_mistral.csv
├── counterfactual_bias_analysis_phi.csv
└── counterfactual_bias_analysis_qwen.csv





- **\*.ipynb**  
  Notebooks performing per‐model analysis and cross‐model summaries.  
- **\*.csv**  
  Raw comparison results for each model.

---

## 🚀 Prerequisites
- Python 3.8+  
- JupyterLab or Jupyter Notebook  
- Python packages:
  - sentence-transformers  
  - textblob  
  - pandas, numpy, scikit-learn  
  - nltk  
  - matplotlib, seaborn  
  - spacy (for embeddings if needed)

---

## 💾 Installation

```bash
# Navigate to this folder
cd ~/BiasEvaluation/Codes_LLM_Runs&Analyses/Counterfactual\ Analysis/Code_Conterfactual_Analysis

# (Optional) Create virtual environment
python3 -m venv venv
source venv/bin/activate

# Install requirements
pip install sentence-transformers textblob pandas numpy scikit-learn nltk matplotlib seaborn spacy

# Download NLTK data and spaCy model
python - <<PYCODE
import nltk; 
nltk.download('punkt'); 
nltk.download('stopwords'); 
nltk.download('vader_lexicon'); 
nltk.download('averaged_perceptron_tagger')
PYCODE

python -m spacy download en_core_web_md
▶️ Usage
Launch Jupyter:


jupyter lab
Open and Run All in each per‐model notebook:

CounterAnalys-GPT4o.ipynb

CounterAnalysisLlama3.1.ipynb

CounterAnalysisMistral.ipynb

CounterAnalysisPhi4.ipynb

CounterAnalysisQwen2.5.ipynb

Open and Run All in summary notebooks:

CounterSentimentShiftAnalysis5LLMs.ipynb

CounterSimilarityDistributionQs5LLMs.ipynb

⚙️ Configuration
No additional configuration needed. Notebooks read CSVs and produce outputs in-place.

📝 Notebook Overview
Notebook	Description
CounterAnalys-GPT4o.ipynb	Counterfactual similarity & sentiment for GPT-4o
CounterAnalysisLlama3.1.ipynb	Counterfactual analysis for LLama 3.1
CounterAnalysisMistral.ipynb	Counterfactual analysis for Mistral-small 3.1
CounterAnalysisPhi4.ipynb	Counterfactual analysis for Phi 4
CounterAnalysisQwen2.5.ipynb	Counterfactual analysis for Qwen 2.5 32B
CounterSentimentShiftAnalysis5LLMs.ipynb	Aggregates mean sentiment shifts across all five LLMs
CounterSimilarityDistributionQs5LLMs.ipynb	Plots semantic similarity distributions by question index

📊 Outputs
CSV files per model

counterfactual_bias_analysis_gpt4o.csv

counterfactual_bias_analysis_llama3.1.csv

counterfactual_bias_analysis_mistral.csv

counterfactual_bias_analysis_phi.csv

counterfactual_bias_analysis_qwen.csv

Summary Plots generated by summary notebooks:

sentiment_shift_comparison_all_models.pdf

similarity_by_question_across_llms.pdf


