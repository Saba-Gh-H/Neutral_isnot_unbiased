# Counterfactual Bias Analysis

Jupyter notebooks and CSV outputs to perform counterfactual bias analysis across five LLMs.  
Compute semantic similarity and sentiment shifts between scenario variations.

---

## ğŸ“‹ Table of Contents
- [About](#about)
- [Repository Structure](#repository-structure)
- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Usage](#usage)
- [Configuration](#configuration)
- [Notebook Overview](#notebook-overview)
- [Outputs](#outputs)
- [Contributing](#contributing)
- [License](#license)

---

## ğŸ§ About
This collection performs counterfactual comparisons of model outputs on neutralâ€name scenarios.  
For each LLM (GPT-4o, LLama 3.1, Mistral 3.1, Phi 4, Qwen 2.5), it computes:
- Semantic similarity (cosine) between variations  
- Sentiment polarity shifts (TextBlob)  

Two summary notebooks aggregate results across all five models.

---

## ğŸ—‚ï¸ Repository Structure

Code_Conterfactual_Analysis/
â”œâ”€â”€ CounterAnalys-GPT4o.ipynb
â”œâ”€â”€ CounterAnalysisLlama3.1.ipynb
â”œâ”€â”€ CounterAnalysisMistral.ipynb
â”œâ”€â”€ CounterAnalysisPhi4.ipynb
â”œâ”€â”€ CounterAnalysisQwen2.5.ipynb
â”œâ”€â”€ CounterSentimentShiftAnalysis5LLMs.ipynb
â”œâ”€â”€ CounterSimilarityDistributionQs5LLMs.ipynb
â”œâ”€â”€ counterfactual_bias_analysis_gpt4o.csv
â”œâ”€â”€ counterfactual_bias_analysis_llama3.1.csv
â”œâ”€â”€ counterfactual_bias_analysis_mistral.csv
â”œâ”€â”€ counterfactual_bias_analysis_phi.csv
â””â”€â”€ counterfactual_bias_analysis_qwen.csv





- **\*.ipynb**  
  Notebooks performing perâ€model analysis and crossâ€model summaries.  
- **\*.csv**  
  Raw comparison results for each model.

---

## ğŸš€ Prerequisites
- Python 3.8+  
- JupyterLab or Jupyter Notebook  
- Python packages:
  - sentence-transformers  
  - textblob  
  - pandas, numpy, scikit-learn  
  - nltk  
  - matplotlib, seaborn  
  - spacy (for embeddings if needed)

---

## ğŸ’¾ Installation

```bash
# Navigate to this folder
cd ~/BiasEvaluation/Codes_LLM_Runs&Analyses/Counterfactual\ Analysis/Code_Conterfactual_Analysis

# (Optional) Create virtual environment
python3 -m venv venv
source venv/bin/activate

# Install requirements
pip install sentence-transformers textblob pandas numpy scikit-learn nltk matplotlib seaborn spacy

# Download NLTK data and spaCy model
python - <<PYCODE
import nltk; 
nltk.download('punkt'); 
nltk.download('stopwords'); 
nltk.download('vader_lexicon'); 
nltk.download('averaged_perceptron_tagger')
PYCODE

python -m spacy download en_core_web_md
â–¶ï¸ Usage
Launch Jupyter:


jupyter lab
Open and Run All in each perâ€model notebook:

CounterAnalys-GPT4o.ipynb

CounterAnalysisLlama3.1.ipynb

CounterAnalysisMistral.ipynb

CounterAnalysisPhi4.ipynb

CounterAnalysisQwen2.5.ipynb

Open and Run All in summary notebooks:

CounterSentimentShiftAnalysis5LLMs.ipynb

CounterSimilarityDistributionQs5LLMs.ipynb

âš™ï¸ Configuration
No additional configuration needed. Notebooks read CSVs and produce outputs in-place.

ğŸ“ Notebook Overview
Notebook	Description
CounterAnalys-GPT4o.ipynb	Counterfactual similarity & sentiment for GPT-4o
CounterAnalysisLlama3.1.ipynb	Counterfactual analysis for LLama 3.1
CounterAnalysisMistral.ipynb	Counterfactual analysis for Mistral-small 3.1
CounterAnalysisPhi4.ipynb	Counterfactual analysis for Phi 4
CounterAnalysisQwen2.5.ipynb	Counterfactual analysis for Qwen 2.5 32B
CounterSentimentShiftAnalysis5LLMs.ipynb	Aggregates mean sentiment shifts across all five LLMs
CounterSimilarityDistributionQs5LLMs.ipynb	Plots semantic similarity distributions by question index

ğŸ“Š Outputs
CSV files per model

counterfactual_bias_analysis_gpt4o.csv

counterfactual_bias_analysis_llama3.1.csv

counterfactual_bias_analysis_mistral.csv

counterfactual_bias_analysis_phi.csv

counterfactual_bias_analysis_qwen.csv

Summary Plots generated by summary notebooks:

sentiment_shift_comparison_all_models.pdf

similarity_by_question_across_llms.pdf


